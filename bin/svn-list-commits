#! /bin/bash

rev=1
dir=.

while getopts "u:r:d:" opt; do
    echo "$opt"
    case $opt in
    r) rev=$OPTARG;;
    d) dir=$OPTARG;;
    h)
	printf "%s -- list svn commits\n" $(basename $0)
	printf "usage: %s [-u<user>|-r<revision>|-d<dir>]...\n" $(basename $0)
	;;

    \?) echo "Invalid option: -$OPTARG" >&2; exit 1 ;;
    :)  echo "Option -$OPTARG requires an argument." >&2;  exit 1;;
    esac
done

shift $(($OPTIND-1))

for i in $*; do
	if [ -d "${dir}/.svn" ]; then
		r=$( cd ${dir}; svn log -r ${rev}:HEAD -v | sed -n "/$1/,/-----\$/ p" )
		if [ "$r" != "" ]; then
			echo "=== $i ==="
			echo "$r"
		fi
	else
		echo "This not an svn work dir ${dir}"
		exit 1
	fi
done
